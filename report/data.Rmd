---
output:
  pdf_document: default
  html_document: default
---

```{r, echo = FALSE, message = FALSE,warning=F}
source("../scripts/setup.R")
```

# Webscraping 
The data we are using within this project is coming from the website "Big Bang Theory Transcripts". It is accessible in the following link : 
[https://bigbangtrans.wordpress.com/](https://bigbangtrans.wordpress.com/series-1-episode-1-pilot-episode/)

Once we webscraped the data, we create a csv file to stock them. Therefore, whenever we want to work with them again, we do not need to webscrap again. We will directly be able to use the file we created. 

```{r include=FALSE}
## DO NOT UN-COMMENT THE CODE UNLESS THERE ARE ANY WEBSCRAPING MODIFICATION TO DO

# # Webscrap the html pages ending to create a loop 
# 
# link.html <- read_html("https://bigbangtrans.wordpress.com/")
# 
# ## Create a list containing all my link endings
# link_end <- link.html %>%
#   html_nodes("#pages-2 a") %>% 
#   html_text2()
# 
# ## convert to lowercase 
# link_end <- tolower(link_end)
# 
# ## remove dash followed by space 
# link_end <- gsub("â€“ ", "", link_end)
# 
# ## replace space by dash
# link_end <- gsub(" ", "-", link_end)
# 
# ## replace 
# link_end <- gsub("series-01-episode-01", "series-1-episode-1", link_end)
# link_end <- gsub("series-01-episode-02", "series-1-episode-2", link_end)
# link_end <- gsub("series-01-episode-03", "series-1-episode-3", link_end)
# link_end <- gsub("series-01-episode-04", "series-1-episode-4", link_end)
# link_end <- gsub("series-01-episode-05", "series-1-episode-5", link_end)
# link_end <- gsub("series-01-episode-06", "series-1-episode-6", link_end)
# link_end <- gsub("series-01-episode-07", "series-1-episode-7", link_end)
# link_end <- gsub("series-01-episode-08", "series-1-episode-8", link_end)
# link_end <- gsub("series-01-episode-09", "series-1-episode-9", link_end)
# link_end <- gsub("series-01", "series-1", link_end)
# link_end <- gsub("series-02", "series-2", link_end)
# link_end <- gsub("series-2-episode-05", "series-2-episode-5", link_end)
# link_end <- gsub("series-2-episode-08", "series-1-episode-08", link_end)
# link_end <- gsub("series-2-episode-10", "series-2-episode-11", link_end)
# link_end <- gsub("series-03", "series-3", link_end)
# link_end <- gsub("series-04", "series-4", link_end)
# link_end <- gsub("series-05", "series-5", link_end)
# link_end <- gsub("series-06", "series-6", link_end)
# link_end <- gsub("series-6-episode-14-the-cooper/kripke-inversion",
#                  "series-6-episode-14-the-cooperkripke-inversion", link_end)
# link_end <- gsub("series-6-episode-23", "series-06-episode-23", link_end)
# link_end <- gsub("series-6-episode-24", "series-06-episode-24", link_end)
# link_end <- gsub("series-07", "series-7", link_end)
# link_end <- gsub("series-08", "series-8", link_end)
# link_end <- gsub("series-8-episode-05", "series-7-episode-05", link_end)
# link_end <- gsub("series-09", "series-9", link_end)

```




```{r include=FALSE}
## DO NOT UN-COMMENT THE CODE UNLESS THERE ARE ANY WEBSCRAPING MODIFICATION TO DO

# ## Loop through my the links with link endings to get the script 
# 
# scripts <- data.frame()
# 
# for(element in 2:length(link_end)){
#   
#   document_id <- paste0("doc", element-2)
#   episode_id <- gsub("-", "_", link_end[element])
#   Link = paste0("https://bigbangtrans.wordpress.com/", link_end[element])
#   
#  if (element < 17){
#    pages = read_html(Link)
#   page_scripts <- pages %>% 
#     html_nodes("#post-3 p , .MsoNormal span , .title") %>% 
#     html_text2()
#   
#   }else if (element == 46){
#   pages = read_html(Link)
#   page_scripts <- pages %>% 
#     html_nodes("content p , em , .title") %>% 
#     html_text2()   
# 
#   
#   }else if (element == 122){
#   pages = read_html(Link)
#   page_scripts <- pages %>% 
#     html_nodes("#content p , .title") %>% 
#     html_text2()   
#   
#   #132-134 || 132 < element < 152
#   }else if (element == 123 || element > 132 & element < 152 || element > 152 & element < 233){
#   pages = read_html(Link)
#   page_scripts <- pages %>% 
#     html_nodes("p+ p , i , .title") %>% 
#     html_text2()  
#   
#   }
#   else{
#   pages = read_html(Link)
#   page_scripts <- pages %>% 
#     html_nodes(".title , #post-68 p , em") %>% 
#     html_text2()
#   }
#   
#   page_scripts <- unique(page_scripts)
#   page_scripts <- paste(page_scripts, collapse='// ')
#   
#   data_frame_col <- c(document_id, episode_id , page_scripts)
#   scripts <- rbind(scripts, data_frame_col)
#   
#   #assign(paste0("doc_", element-2), data_frame_col)
# 
#   print(episode_id)
# }
# 
# colnames(scripts) <- c("document", "title", "script")
# write.csv(scripts, "../data/series_scripts.csv", row.names = FALSE)

```


# Download created data file 
We see that our data set has 231 rows and 3 columns:

-   *document* : represent the index and tells us which document it is.
-   *title* : contains the title of the script. It tells us the series and episode number
-   *script* : contains the whole script for each corresponding episode. Note that the end-line symbol is '\\'. 

```{r echo=FALSE}
data_scripts <- read.csv("../data/series_scripts.csv")

summary(data_scripts)%>%
  kbl(caption = "Characteristics of the data's columns ")%>%
  kable_styling(latex_options = "HOLD_position")
```


Here is a glimpse on how the data set looks like : 

```{r echo=FALSE }
data_scripts[1:1, ] %>%
  kbl(caption = "The 1 first row of the data set") %>%
  kable_classic(full_width = T, html_font = "Cambria", font_size = 7) %>%
  kable_styling(latex_options = "HOLD_position")
```


# Aggregate the data by season 
We realise that the analysis per episode can fast become tedious and less meaningful, we decide to aggregate the episodes by season. This way we get all the scripts of each season's episode on one concatenated string. 

```{r echo=FALSE}
### Analysis by season and not by episode, should we make an average ?)
# Add a row indicating the season number
data_scripts$season <- c(
  1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
  2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,
  3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,
  4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,
  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,
  9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
  10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10)
```

```{r echo=FALSE}
season_scripts <- aggregate(data_scripts$script, list(data_scripts$season),
                            paste, collapse="")
names(season_scripts) <- c("season", "agg_script")
```

```{r echo=FALSE}
write.csv(season_scripts, "../data/season_scripts.csv", row.names = FALSE)
```







